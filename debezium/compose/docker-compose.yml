version: '3'
services:
  zookeeper:
    image: debezium/zookeeper:1.4
    networks:
      - debezium-docker-net
    ports:
      - '2181:2181'
      - '2888:2888'
      - '3888:3888'
    environment: 
      - TZ=Asia/Seoul
  kafka:
    image: debezium/kafka:1.4
    networks:
      - debezium-docker-net
    ports:
      - '9092:9092'
    depends_on:
      - zookeeper
    environment:
      - TZ=Asia/Seoul
      - ZOOKEEPER_CONNECT=zookeeper:2181
  mysql:
    image: megachj/debezium.mysql_example:1.0
    networks:
      - debezium-docker-net
    ports:
      - '3306:3306'
    environment:
      - TZ=Asia/Seoul
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_USER=debezium
      - MYSQL_PASSWORD=debeziumpw
  connect1:
    image: debezium/connect:1.4
    networks:
      - debezium-docker-net
    ports:
      - '8083:8083'
    depends_on:
      - zookeeper
      - kafka
      - mysql
    environment:
      - TZ=Asia/Seoul
      - BOOTSTRAP_SERVERS=kafka:9092
      - GROUP_ID=connect-cluster-A
      - CONFIG_STORAGE_TOPIC=connect.configs
      - OFFSET_STORAGE_TOPIC=connect.offsets
      - STATUS_STORAGE_TOPIC=connect.statuses
      - CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR=1
      - CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR=1
      - CONNECT_STATUS_STORAGE_REPLICATION_FACTOR=1
      - OFFSET_FLUSH_TIMEOUT_MS=60000
  connect2:
    image: debezium/connect:1.4
    networks:
      - debezium-docker-net
    ports:
      - '8084:8083'
    depends_on:
      - zookeeper
      - kafka
      - mysql
    environment:
      - TZ=Asia/Seoul
      - BOOTSTRAP_SERVERS=kafka:9092
      - GROUP_ID=connect-cluster-A
      - CONFIG_STORAGE_TOPIC=connect.configs
      - OFFSET_STORAGE_TOPIC=connect.offsets
      - STATUS_STORAGE_TOPIC=connect.statuses
      - CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR=1
      - CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR=1
      - CONNECT_STATUS_STORAGE_REPLICATION_FACTOR=1
      - OFFSET_FLUSH_TIMEOUT_MS=60000

networks: 
  debezium-docker-net:
    external:
      name: debezium-docker-net
